<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="Creating new modules">

        <meta property="og:site_name" content="Recipe Runner"/>
        <meta property="og:title" content="Developers: Create new modules | Recipe Runner"/>
        <meta property="og:description" content="Creating new modules"/>
        <meta property="og:url" content="https://recipe-runner.yosymfony.com/docs/creating-new-modules"/>
        <meta property="og:image" content="/assets/img/logo.png"/>
        <meta property="og:type" content="website"/>

        <meta name="twitter:image:alt" content="Recipe Runner">
        <meta name="twitter:card" content="summary_large_image">

        <title>Recipe Runner | Developers: Create new modules</title>

        <link rel="home" href="https://recipe-runner.yosymfony.com">
        <link rel="icon" href="/favicon.ico">

        
                    <!-- Insert analytics code here -->
        
        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i,800,800i" rel="stylesheet">
        <link rel="stylesheet" href="/assets/build/css/main.css?id=056bfad0f144804bd3ed">

            </head>

    <body class="flex flex-col justify-between min-h-screen bg-grey-lightest text-grey-darkest leading-normal font-sans">
        <header class="flex items-center bg-white border-b h-24 mb-8 py-4" role="banner">
            <div class="container flex items-center max-w-4xl mx-auto px-4 lg:px-8">
                <div class="flex items-center">
                    <a href="/" title="Recipe Runner home" class="inline-flex items-center">
                        <img class="h-8 md:h-10 mr-3" src="/assets/img/short_logo.svg" alt="Recipe Runner logo" />

                        <h1 class="text-lg md:text-2xl text-blue-darkest font-semibold hover:text-blue-dark my-0 pr-4">Recipe Runner</h1>
                    </a>
                </div>

                <div class="flex flex-1 justify-end items-center text-right md:pl-10">
                                    </div>
            </div>

                <button class="flex justify-center items-center bg-blue border border-blue h-10 mr-4 px-5 rounded-full lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

        </header>

        <main role="main" class="w-full flex-auto">
            <section class="container max-w-4xl mx-auto px-6 md:px-8 py-4">
    <div class="flex flex-col lg:flex-row">
        <nav id="js-nav-menu" class="nav-menu hidden lg:block">
            <ul class="list-reset my-0">
            <li class="list-reset pl-4">
            
        <a href="/docs/getting-started"
            class="lvl0   nav-menu__item hover:text-blue"
        >
            Getting Started
        </a>
    
    </li>
            <li class="list-reset pl-4">
            
        <a href="/docs/recipes"
            class="lvl0   nav-menu__item hover:text-blue"
        >
            Recipes
        </a>
    
            
        <ul class="list-reset my-0">
            <li class="list-reset pl-4">
            
        <a href="/docs/steps"
            class="lvl1   nav-menu__item hover:text-blue"
        >
            Steps
        </a>
    
    </li>
            <li class="list-reset pl-4">
            
        <a href="/docs/actions"
            class="lvl1   nav-menu__item hover:text-blue"
        >
            Actions
        </a>
    
    </li>
            <li class="list-reset pl-4">
            
        <a href="/docs/conditionals"
            class="lvl1   nav-menu__item hover:text-blue"
        >
            Conditionals
        </a>
    
    </li>
            <li class="list-reset pl-4">
            
        <a href="/docs/loops"
            class="lvl1   nav-menu__item hover:text-blue"
        >
            Loops
        </a>
    
    </li>
            <li class="list-reset pl-4">
            
        <a href="/docs/variables"
            class="lvl1   nav-menu__item hover:text-blue"
        >
            Variables
        </a>
    
    </li>
            <li class="list-reset pl-4">
            
        <a href="/docs/recipe-syntax"
            class="lvl1   nav-menu__item hover:text-blue"
        >
            Recipe syntax
        </a>
    
    </li>
    </ul>
    </li>
            <li class="list-reset pl-4">
            
        <a href="/docs/expressions"
            class="lvl0   nav-menu__item hover:text-blue"
        >
            Expressions
        </a>
    
            
        <ul class="list-reset my-0">
            <li class="list-reset pl-4">
            
        <a href="/docs/functions"
            class="lvl1   nav-menu__item hover:text-blue"
        >
            Functions
        </a>
    
    </li>
    </ul>
    </li>
            <li class="list-reset pl-4">
            
        <a href="/docs/modules"
            class="lvl0   nav-menu__item hover:text-blue"
        >
            Modules
        </a>
    
            
        <ul class="list-reset my-0">
            <li class="list-reset pl-4">
            
        <a href="/docs/io-module"
            class="lvl1   nav-menu__item hover:text-blue"
        >
            IO module
        </a>
    
    </li>
            <li class="list-reset pl-4">
            
        <a href="/docs/system-module"
            class="lvl1   nav-menu__item hover:text-blue"
        >
            System module
        </a>
    
    </li>
    </ul>
    </li>
            <li class="list-reset pl-4">
            
        <a href="/docs/developers"
            class="lvl0 lvl0-active  nav-menu__item hover:text-blue"
        >
            Developers
        </a>
    
            
        <ul class="list-reset my-0">
            <li class="list-reset pl-4">
            
        <a href="/docs/creating-new-modules"
            class="lvl1  active font-semibold text-blue nav-menu__item hover:text-blue"
        >
            Creating new modules
        </a>
    
    </li>
            <li class="list-reset pl-4">
            
        <a href="/docs/embedding-recipe-runner-core"
            class="lvl1   nav-menu__item hover:text-blue"
        >
            Embedding Recipe Runner core
        </a>
    
    </li>
    </ul>
    </li>
    </ul>
        </nav>

        <div class="w-full lg:w-3/5 break-words pb-16 lg:pl-4" v-pre>
            <h1>Developers: creating new modules</h1>
<ul>
<li><a href="#creating_a_project">Creating a project for a module</a></li>
<li><a href="#module_class">The module class</a></li>
<li><a href="#testing">Testing a module</a></li>
</ul>
<h2 id="creating_a_project">Creating a project for a module</h2>
<ol>
<li>Create a project based on the starter template:</li>
</ol>
<pre><code class="language-bash">$ composer create-project recipe-runner/module-template:1.0.x-dev your-module-name</code></pre>
<ol start="2">
<li>Navigate to your new project directory. The structure of the project is the following:</li>
</ol>
<ul>
<li><code>src</code>: source code.</li>
<li><code>tests</code>: tests suite.</li>
</ul>
<p>The starter template comes with a module that exposes one method called <code>print</code> that let you write a message using
the <a href="https://github.com/recipe-runner/recipe-runner/blob/master/src/IO/IOInterface.php"><code>IOInterface</code></a>.
If you want to run the test suite, type <code>composer test</code>. Integration with Travis CI is included out of the box.
If you don't want to use a <em>continuous integration</em> system or you want to use another service such as Circle CI, remove
the file <code>.travis.yml</code>.</p>
<h2 id="module_class">The module class</h2>
<p>Modules are PHP classes that implement <a href="https://github.com/recipe-runner/recipe-runner/blob/master/src/Module/ModuleInterface.php"><code>ModuleInterface</code></a>. The interface let a module exposes its methods and receives the instancies of
<a href="https://github.com/recipe-runner/recipe-runner/blob/master/src/Expression/ExpressionResolverInterface.php"><code>ExpressionResolverInterface</code></a>
and <a href="https://github.com/recipe-runner/recipe-runner/blob/master/src/IO/IOInterface.php"><code>IOInterface</code></a>.</p>
<p>For convenience, there is an abstract class called <a href="https://github.com/recipe-runner/recipe-runner/blob/master/src/Module/ModuleBase.php"><code>ModuleBase</code></a> that implements most of the interface and has some useful methods.</p>
<p>Below down, the module example from the starter template:</p>
<pre><code class="language-php">namespace RecipeRunner\ModuleName;

use RecipeRunner\RecipeRunner\Module\Invocation\ExecutionResult;
use RecipeRunner\RecipeRunner\Module\Invocation\Method;
use RecipeRunner\RecipeRunner\Module\ModuleBase;
use Yosymfony\Collection\CollectionInterface;

class ModuleClass extends ModuleBase
{
    public function __construct()
    {
        parent::__construct();

        $this-&gt;addMethodHandler('print', [$this, 'print']);
    }

    /**
     * Runs a method. This method is part of ModuleInterface.
     */
    public function runMethod(Method $method, CollectionInterface $recipeVariables) : ExecutionResult
    {
        // Usually, you do not have to do anything here.

        return $this-&gt;runInternalMethod($method, $recipeVariables);
    }

    protected function print(Method $method): ExecutionResult
    {
        $message = $method-&gt;getParameterNameOrPosition('message', 0);
        $io = $this-&gt;getIO();
        $io-&gt;write($message);

        $jsonResponse = \json_encode(['message' =&gt; $message]);
        $isSuccessful = true;

        return new ExecutionResult($jsonResponse, $isSuccessful);
    }
}</code></pre>
<h3>The constructor</h3>
<p>Inside the constructor, the method handlers are registered using <code>addMethodHandler</code>.
The first parámeter is the public name of the method, the one used in any recipe, and the second
argument is for the callable function: <code>[$this, 'class-method-name']</code>. Usually, method handlers
are <code>protected</code> methods as you want to see they are properly register in the constructor. That
way, if you want to test a method you have to do it through the method <code>runMethod</code>.</p>
<blockquote>
<p>It's important to call the parent constructor so you don't lose any variable initialization.</p>
</blockquote>
<h3>The class Method</h3>
<p><a href="https://github.com/recipe-runner/recipe-runner/blob/master/src/Module/Invocation/Method.php">This class</a>
contains information about the method: name and parameters as well as some useful methods such as
<code>getParameterNameOrPosition</code> or <code>getParameters</code>. The former returns the parameter that match the name or is in the position passed as argument the latter returns the <a href="https://github.com/yosymfony/collection">collection</a> of parameters of the method.</p>
<h3>The class ExecutionResult</h3>
<p><a href="https://github.com/recipe-runner/recipe-runner/blob/master/src/Module/Invocation/ExecutionResult.php">This class</a>
Modules return a data structure that can be registered into a variable (see <a href="actions/#registering_execution">actions</a>). That data structure is a JSON with the information the module may consider
appropriate. In the case of the <code>print</code> method, <code>message</code> is a parameter that contains the text
it displayed.</p>
<h2 id="testing">Testing a module</h2>
<p>The starter template contains an <a href="https://github.com/recipe-runner/module-template/blob/master/tests/ModuleClassTest.php">example</a>
about how to test the method <code>print</code>. Support for PHPUnit is included out of the box.</p>
<pre><code class="language-php">namespace RecipeRunner\ModuleName\Test;

use PHPUnit\Framework\TestCase;
use RecipeRunner\RecipeRunner\IO\IOInterface;
use RecipeRunner\RecipeRunner\Module\Invocation\ExecutionResult;
use RecipeRunner\RecipeRunner\Module\Invocation\Method;
use RecipeRunner\ModuleName\ModuleClass;
use Yosymfony\Collection\MixedCollection;

class ModuleClassTest extends TestCase
{
    /** @var ModuleClass */
    private $module;

    public function setUp(): void
    {
        $IOMock = $this-&gt;getMockBuilder(IOInterface::class)-&gt;getMock();
        $this-&gt;module = new ModuleClass();
        $this-&gt;module-&gt;setIO($IOMock);
    }

    public function testMethodPrint()
    {
        $message = 'hi';
        $method = new Method('print');
        $method-&gt;addParameter('message', $message);

        $executionResult = $this-&gt;module-&gt;runMethod($method, new MixedCollection());

        $this-&gt;assertTrue($executionResult-&gt;isSuccess());
        $this-&gt;assertEquals([
            'message' =&gt; $message
        ], $this-&gt;getResultAsArray($executionResult));
    }

    private function getResultAsArray(ExecutionResult $result): array
    {
        return \json_decode($result-&gt;getJsonResult(), true);
    }
}</code></pre>        </div>
    </div>
</section>
        </main>

        <script src="/assets/build/js/main.js?id=bb56897b98ee16fac083"></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>

        <footer class="bg-white text-center text-sm mt-12 py-4" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center list-reset">
                <li class="md:mr-2">
                    &copy; <a href="https://recipe-runner.yosymfony.com" title="Recipe Runner">Recipe Runner</a> 2019
                </li>
                <li>| <a href="https://medium.com/@YoSymfony" title="Blog">Blog</a></li>
            </ul>
        </footer>
    </body>
</html>
